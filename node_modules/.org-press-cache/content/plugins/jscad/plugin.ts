// Source display only (not executed)
export default "/**\n * Org-Press JSCad Block Plugin\n *\n * Provides 3D modeling support for org-mode using JSCad\n */\n\nimport type {\n  BlockPlugin,\n  CodeBlock,\n  TransformContext,\n  TransformResult\n} from \"org-press\";\nimport { createBlockId, parseBlockParameters } from \"org-press\";\n\n/**\n * JSCad virtual module plugin\n * Returns a React component that renders the JSCad viewer\n *\n * Preview API compatible:\n * - :use jscad → renders interactive 3D model\n * - :use jscad | sourceOnly → shows source code only\n * - :use jscad | withSourceCode → shows both code and model\n */\nexport const jscadPlugin: BlockPlugin = {\n  name: 'jscad',\n  defaultExtension: 'js',\n\n  /**\n   * Transform returns code that renders the JSCad viewer\n   * - sourceOnly mode: returns code for display without rendering\n   * - preview mode: returns render function for interactive 3D model\n   */\n  async transform(block: CodeBlock, context: TransformContext): Promise<TransformResult> {\n    // Create stable ID for this block using utility\n    const stableId = createBlockId(context.orgFilePath, context.blockIndex);\n\n    // Parse block parameters\n    const params = parseBlockParameters(block.meta || \"\");\n\n    // Check for mode from :use parameter (e.g., :use jscad | sourceOnly)\n    const useValue = params.use || 'jscad';\n    const useParts = useValue.split('|').map((s: string) => s.trim());\n    const mode = useParts.length > 1 ? useParts[1] : 'preview';\n\n    // Handle sourceOnly mode - just return the source code\n    if (mode === 'sourceOnly') {\n      return {\n        code: `// JSCad model source (display only)\\nexport default ${JSON.stringify(block.value)};`,\n      };\n    }\n\n    // Create virtual module ID for the model code\n    // The virtual blocks plugin will handle rewriting imports and returning the model code\n    const modelModuleId = params.name\n      ? `virtual:org-press:block:jscad-model:${context.orgFilePath}:NAME:${params.name}`\n      : `virtual:org-press:block:jscad-model:${context.orgFilePath}:${context.blockIndex}`;\n\n    // Get height from block parameters or use default\n    const height = params.height || \"400px\";\n\n    // Return render function that receives container ID from exporter\n    // The exporter creates a container with ID `org-block-${index}-result`\n    return {\n      code: `\nimport renderJSCad from '@org-press/block-jscad/wrapper';\nexport * from '${modelModuleId}';\n\n// Export render function - exporter will call this with container ID\nexport default function render(containerId) {\n  const container = document.getElementById(containerId);\n  if (!container) {\n    console.error('[JSCad] Container not found:', containerId);\n    return;\n  }\n\n  // Style the container for jscad\n  container.className = 'jscad-wrapper';\n  container.style.cssText = 'position: relative; height: ${height};';\n  container.setAttribute('data-storage-key', '${stableId}');\n\n  // Import the model code from virtual module and render\n  import('${modelModuleId}').then((module) => {\n    renderJSCad(container, module.default);\n  }).catch(err => {\n    console.error('[JSCad] Failed to load model:', err);\n    container.innerHTML = '<div style=\"color: red;\">Error loading JSCad model: ' + err.message + '</div>';\n  });\n}\n      `,\n    };\n  },\n};\n\n// Default export for convenience\nexport default jscadPlugin;\n";