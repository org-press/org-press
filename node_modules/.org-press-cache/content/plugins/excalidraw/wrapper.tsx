// Source display only (not executed)
export default "/**\n * Excalidraw wrapper for rendering interactive diagrams\n */\nimport { Excalidraw } from \"@excalidraw/excalidraw\";\nimport { ExcalidrawImperativeAPI } from \"@excalidraw/excalidraw/types\";\nimport \"@excalidraw/excalidraw/index.css\";\nimport { createElement, useState, useRef } from \"react\";\nimport { createRoot } from \"react-dom/client\";\n\nexport interface ExcalidrawData {\n  type?: string;\n  version?: number;\n  source?: string;\n  elements: Array<{\n    type: string;\n    id?: string;\n    x?: number;\n    y?: number;\n    width?: number;\n    height?: number;\n    [key: string]: any;\n  }>;\n  appState?: {\n    viewBackgroundColor?: string;\n    [key: string]: any;\n  };\n  files?: Record<string, any>;\n}\n\nexport interface ExcalidrawWrapperProps {\n  initialData: ExcalidrawData;\n  mode: \"view\" | \"edit\";\n  filePath?: string;\n  blockId?: string;\n}\n\n/**\n * Excalidraw wrapper component with fullscreen, view/edit toggle, and save\n */\nexport function ExcalidrawWrapper({\n  initialData,\n  mode,\n  filePath,\n  blockId,\n}: ExcalidrawWrapperProps) {\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [isViewMode, setIsViewMode] = useState(mode === \"view\");\n  const [isSaving, setIsSaving] = useState(false);\n  const excalidrawRef = useRef<ExcalidrawImperativeAPI>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const toggleFullscreen = async () => {\n    if (!containerRef.current) return;\n\n    try {\n      if (!document.fullscreenElement) {\n        await containerRef.current.requestFullscreen();\n        setIsFullscreen(true);\n      } else {\n        await document.exitFullscreen();\n        setIsFullscreen(false);\n      }\n    } catch (error) {\n      console.error(\"Fullscreen toggle failed:\", error);\n    }\n  };\n\n  const handleSave = async () => {\n    if (!excalidrawRef.current || !filePath || isViewMode) {\n      return;\n    }\n\n    setIsSaving(true);\n    try {\n      const elements = excalidrawRef.current.getSceneElements();\n      const appState = excalidrawRef.current.getAppState();\n      const files = excalidrawRef.current.getFiles();\n\n      const data: ExcalidrawData = {\n        type: \"excalidraw\",\n        version: 2,\n        source: \"https://excalidraw.com\",\n        elements: elements as any[],\n        appState: {\n          viewBackgroundColor: appState.viewBackgroundColor,\n        },\n        files: files || {},\n      };\n\n      const response = await fetch(\"/api/save-excalidraw\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          filePath,\n          blockId,\n          data,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Save failed: ${response.statusText}`);\n      }\n\n      const result = await response.json();\n      console.log(\"Saved successfully:\", result);\n      alert(\"Diagram saved successfully!\");\n    } catch (error) {\n      console.error(\"Save failed:\", error);\n      alert(`Failed to save: ${error.message}`);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  const toggleEditMode = () => {\n    setIsViewMode(!isViewMode);\n  };\n\n  const handleFullscreenChange = () => {\n    setIsFullscreen(!!document.fullscreenElement);\n  };\n\n  if (typeof document !== \"undefined\") {\n    document.addEventListener(\"fullscreenchange\", handleFullscreenChange);\n  }\n\n  return createElement(\n    \"div\",\n    {\n      ref: containerRef,\n      className: `excalidraw-container ${isFullscreen ? \"fullscreen\" : \"\"}`,\n      style: {\n        width: \"100%\",\n        height: isFullscreen ? \"100vh\" : \"500px\",\n        position: \"relative\",\n        border: \"1px solid #e0e0e0\",\n        borderRadius: \"8px\",\n        overflow: \"hidden\",\n      },\n    },\n    [\n      // Toolbar\n      createElement(\n        \"div\",\n        {\n          key: \"toolbar\",\n          className: \"excalidraw-toolbar\",\n          style: {\n            position: \"absolute\",\n            top: \"10px\",\n            right: \"10px\",\n            zIndex: 1000,\n            display: \"flex\",\n            gap: \"8px\",\n            padding: \"8px\",\n            background: \"rgba(255, 255, 255, 0.95)\",\n            borderRadius: \"8px\",\n            boxShadow: \"0 2px 8px rgba(0,0,0,0.15)\",\n          },\n        },\n        [\n          mode === \"view\" &&\n            createElement(\n              \"button\",\n              {\n                key: \"toggle-edit\",\n                onClick: toggleEditMode,\n                style: {\n                  padding: \"6px 12px\",\n                  border: \"1px solid #ccc\",\n                  borderRadius: \"4px\",\n                  background: isViewMode ? \"#fff\" : \"#4CAF50\",\n                  color: isViewMode ? \"#333\" : \"#fff\",\n                  cursor: \"pointer\",\n                  fontSize: \"14px\",\n                  fontWeight: \"500\",\n                },\n              },\n              isViewMode ? \"Edit\" : \"View\"\n            ),\n\n          mode === \"edit\" &&\n            filePath &&\n            createElement(\n              \"button\",\n              {\n                key: \"save\",\n                onClick: handleSave,\n                disabled: isSaving,\n                style: {\n                  padding: \"6px 12px\",\n                  border: \"1px solid #4CAF50\",\n                  borderRadius: \"4px\",\n                  background: \"#4CAF50\",\n                  color: \"#fff\",\n                  cursor: isSaving ? \"not-allowed\" : \"pointer\",\n                  fontSize: \"14px\",\n                  fontWeight: \"500\",\n                  opacity: isSaving ? 0.6 : 1,\n                },\n              },\n              isSaving ? \"Saving...\" : \"Save\"\n            ),\n\n          createElement(\n            \"button\",\n            {\n              key: \"fullscreen\",\n              onClick: toggleFullscreen,\n              style: {\n                padding: \"6px 12px\",\n                border: \"1px solid #ccc\",\n                borderRadius: \"4px\",\n                background: \"#fff\",\n                color: \"#333\",\n                cursor: \"pointer\",\n                fontSize: \"14px\",\n                fontWeight: \"500\",\n              },\n            },\n            isFullscreen ? \"Exit Fullscreen\" : \"Fullscreen\"\n          ),\n        ]\n      ),\n\n      // Excalidraw component\n      createElement(\n        \"div\",\n        {\n          key: \"excalidraw\",\n          style: {\n            width: \"100%\",\n            height: \"100%\",\n          },\n        },\n        createElement(Excalidraw, {\n          initialData,\n          viewModeEnabled: isViewMode,\n          zenModeEnabled: isViewMode,\n          gridModeEnabled: false,\n          excalidrawAPI: (api: ExcalidrawImperativeAPI) => {\n            (excalidrawRef as any).current = api;\n          },\n        })\n      ),\n    ]\n  );\n}\n\n/**\n * Render Excalidraw diagram in a container element\n */\nexport default function renderExcalidraw(\n  container: HTMLElement,\n  data: ExcalidrawData,\n  mode: \"view\" | \"edit\" = \"view\",\n  filePath?: string,\n  blockId?: string\n): void {\n  if (!container) {\n    console.error(\"Excalidraw: Container element not found\");\n    return;\n  }\n\n  if (!data || !data.elements) {\n    console.error(\"Excalidraw: Invalid data format\", data);\n    container.innerHTML = `\n      <div style=\"padding: 20px; border: 2px solid #ff6b6b; border-radius: 4px; background: #ffe0e0;\">\n        <strong>Error:</strong> Invalid Excalidraw data format\n      </div>\n    `;\n    return;\n  }\n\n  const root = createRoot(container);\n  root.render(\n    createElement(ExcalidrawWrapper, {\n      initialData: data,\n      mode,\n      filePath,\n      blockId,\n    })\n  );\n}\n";