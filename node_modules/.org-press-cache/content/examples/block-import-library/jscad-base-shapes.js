import * as jscad from '@jscad/modeling';

const { cube, sphere, cylinder, cuboid } = jscad.primitives;
const { translate, scale, rotate } = jscad.transforms;
const { union, subtract, intersect } = jscad.booleans;
const { colorize } = jscad.colors;

/**
 * Create a rounded cube
 */
export function roundedCube(size = 10, radius = 2) {
  const mainCube = cuboid({ size: [size, size, size] });
  const corners = [];

  const offset = size / 2 - radius;
  for (let x of [-1, 1]) {
    for (let y of [-1, 1]) {
      for (let z of [-1, 1]) {
        corners.push(
          translate(
            [x * offset, y * offset, z * offset],
            sphere({ radius })
          )
        );
      }
    }
  }

  return union(mainCube, ...corners);
}

/**
 * Create a simple house shape
 */
export function house(width = 20, height = 15) {
  const base = cuboid({ size: [width, width, height] });
  const roof = translate(
    [0, 0, height / 2],
    rotate(
      [Math.PI / 4, 0, 0],
      cuboid({ size: [width, width * 1.4, 2] })
    )
  );

  return colorize([0.8, 0.6, 0.4], union(base, roof));
}

/**
 * Create a gear tooth
 */
export function gear(teeth = 12, innerRadius = 10, outerRadius = 15, thickness = 3) {
  const base = cylinder({ radius: innerRadius, height: thickness });
  const toothAngle = (2 * Math.PI) / teeth;
  const teethShapes = [];

  for (let i = 0; i < teeth; i++) {
    const angle = i * toothAngle;
    const tooth = translate(
      [Math.cos(angle) * (innerRadius + outerRadius) / 2,
       Math.sin(angle) * (innerRadius + outerRadius) / 2,
       0],
      rotate(
        [0, 0, angle],
        cuboid({ size: [outerRadius - innerRadius, 2, thickness] })
      )
    );
    teethShapes.push(tooth);
  }

  return colorize([0.7, 0.7, 0.8], union(base, ...teethShapes));
}


function render(result, el) {
  // Skip null/undefined
  if (result === null || result === undefined) return;
  // Handle function exports (render function that takes container ID)
  if (typeof result === "function") {
    result(el.id);
  }
  // Handle HTMLElement exports
  else if (result instanceof HTMLElement) {
    if (!el.hasChildNodes()) el.appendChild(result);
  }
  // Handle string exports (could be HTML or plain text)
  else if (typeof result === "string") {
    if (result.trim().startsWith("<")) {
      el.innerHTML = result;
    } else {
      el.textContent = result;
    }
  }
  // Handle numbers and booleans
  else if (typeof result === "number" || typeof result === "boolean") {
    el.textContent = String(result);
  }
  // Handle objects/arrays (display as formatted JSON)
  else if (typeof result === "object") {
    el.innerHTML = "<pre>" + JSON.stringify(result, null, 2) + "</pre>";
  }
}
export { render };