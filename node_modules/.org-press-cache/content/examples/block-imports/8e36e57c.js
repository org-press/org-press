// Import from THIS file (self-import)
import { processData } from './block-imports.org?name=data-processor';

// Import from EXTERNAL library file
import { fibonacci } from './block-import-library.org?name=math-utils';
import { truncate } from './block-import-library.org?name=string-utils';

// Generate fibonacci sequence using imported function
const fibSequence = Array.from({ length: 10 }, (_, i) => fibonacci(i));

// Process the data using local function
const stats = processData(fibSequence);

// Format output using imported utility
const title = truncate("Fibonacci Sequence Analysis with Mixed Imports", 40);

const container = document.createElement('div');
container.style.cssText = 'padding: 1rem; background: #f3e5f5; border-radius: 8px; margin: 1rem 0;';
container.innerHTML = `
  <h4 style="margin-top: 0; color: #7b1fa2;">${title}</h4>
  <p><strong>Sequence:</strong> [${fibSequence.join(', ')}]</p>
  <p><strong>Sum:</strong> ${stats.sum}</p>
  <p><strong>Average:</strong> ${stats.average.toFixed(2)}</p>
  <p><strong>Max:</strong> ${stats.max}</p>
  <p><strong>Min:</strong> ${stats.min}</p>
  <hr style="border: none; border-top: 1px solid #ddd; margin: 1rem 0;">
  <p><small>
    ðŸ”¹ fibonacci() from <code>block-import-library.org</code><br>
    ðŸ”¹ truncate() from <code>block-import-library.org</code><br>
    ðŸ”¹ processData() from <code>block-imports.org</code> (this file)
  </small></p>
`;

export default container;


function render(result, el) {
  // Skip null/undefined
  if (result === null || result === undefined) return;
  // Handle function exports (render function that takes container ID)
  if (typeof result === "function") {
    result(el.id);
  }
  // Handle HTMLElement exports
  else if (result instanceof HTMLElement) {
    if (!el.hasChildNodes()) el.appendChild(result);
  }
  // Handle string exports (could be HTML or plain text)
  else if (typeof result === "string") {
    if (result.trim().startsWith("<")) {
      el.innerHTML = result;
    } else {
      el.textContent = result;
    }
  }
  // Handle numbers and booleans
  else if (typeof result === "number" || typeof result === "boolean") {
    el.textContent = String(result);
  }
  // Handle objects/arrays (display as formatted JSON)
  else if (typeof result === "object") {
    el.innerHTML = "<pre>" + JSON.stringify(result, null, 2) + "</pre>";
  }
}
export { render };