#+TITLE: CLI Carousel Section
#+DESCRIPTION: CLI commands carousel demo

* CLI Carousel Section

Section showcasing CLI commands with a scroll-linked carousel.

#+NAME: carousel
#+begin_src typescript
/**
 * CLI Carousel Section
 *
 * Features:
 * - Scroll-linked command carousel
 * - CLI features list
 * - Animated highlighting
 */

// CLI commands for carousel
const CLI_COMMANDS = [
  { cmd: 'fmt', desc: 'Format org files and code blocks' },
  { cmd: 'lint', desc: 'Check for style and syntax issues' },
  { cmd: 'test', desc: 'Run tests from code blocks' },
  { cmd: 'type-check', desc: 'TypeScript type validation' },
  { cmd: 'build', desc: 'Build for production' },
];

export function createCarousel(): HTMLElement {
  const section = document.createElement('section');
  section.className = 'landing-section cli-carousel-section';
  section.id = 'cli';

  section.innerHTML = `
    <div class="section-content">
      <div class="section-text">
        <span class="section-label">Developer Tools</span>
        <h2>Super-Charge Literate Programming</h2>
        <p>
          A complete CLI toolkit for working with org files.
          Format, lint, test, and build your literate documents
          with powerful command-line tools.
        </p>
        <div class="cli-features">
          <div class="cli-feature">
            <strong>orgp fmt</strong> - Auto-format code blocks
          </div>
          <div class="cli-feature">
            <strong>orgp test</strong> - Run inline tests with Vitest
          </div>
          <div class="cli-feature">
            <strong>orgp build</strong> - Production-ready static sites
          </div>
        </div>
      </div>
      <div class="section-visual">
        <div class="cli-window">
          <div class="cli-header">
            <span class="cli-prompt">&gt; orgp</span>
          </div>
          <div class="cli-carousel-container">
            <div class="cli-carousel" id="cli-carousel">
              ${CLI_COMMANDS.map((item, i) => `
                <div class="cli-item${i === 0 ? ' active' : ''}" data-index="${i}">
                  <span class="cli-cmd">${item.cmd}</span>
                  <span class="cli-desc">${item.desc}</span>
                </div>
              `).join('')}
            </div>
            <div class="cli-highlight"></div>
          </div>
        </div>
      </div>
    </div>
  `;

  // Set up scroll-linked carousel animation
  let currentCliIndex = 0;

  function updateCarousel() {
    const rect = section.getBoundingClientRect();
    const sectionProgress = Math.max(0, Math.min(1,
      (window.innerHeight / 2 - rect.top) / rect.height
    ));

    const newIndex = Math.min(
      CLI_COMMANDS.length - 1,
      Math.floor(sectionProgress * CLI_COMMANDS.length)
    );

    if (newIndex !== currentCliIndex) {
      currentCliIndex = newIndex;

      const items = section.querySelectorAll('.cli-item');
      items.forEach((item, i) => {
        item.classList.toggle('active', i === currentCliIndex);
      });

      const carousel = section.querySelector('#cli-carousel') as HTMLElement;
      if (carousel) {
        const offset = -currentCliIndex * 52;
        carousel.style.transform = `translateY(${offset}px)`;
      }
    }
  }

  let carouselTicking = false;
  window.addEventListener('scroll', () => {
    if (!carouselTicking) {
      requestAnimationFrame(() => {
        updateCarousel();
        carouselTicking = false;
      });
      carouselTicking = true;
    }
  }, { passive: true });

  return section;
}

export default createCarousel();
#+end_src
